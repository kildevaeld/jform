!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("views")):"function"==typeof define&&define.amd?define(["views"],e):"object"==typeof exports?exports.jform=e(require("views")):t.jform=e(t.views)}(this,function(t){return function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){function n(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function o(t,e){if(void 0===e&&(e={}),"string"==typeof t){var r=document.querySelector(t);if(!r)return null;e.el=r}else t instanceof HTMLElement?e.el=t:e=t;return new i.Form(e)}var i=r(4),a=r(5),s=r(11),u=r(1),l=r(8);n(r(4)),e.create=o;var c;!function(t){function e(t,e){var r=u.Editor.extend(e,{});return a.set(r,t),r}function r(t){return a.get(t)}t.ValidationError=l.FormValidationError,t.extend=e,t.get=r}(c=e.editors||(e.editors={}));var h;!function(t){function e(t,e,n){s.Validator.validators[t]=e,r(t,n)}function r(t,e){s.Validator.messages[t]=e}t.add=e,t.addMessage=r}(h=e.validators||(e.validators={}))},function(t,e,r){var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},o=r(2),i=r(3),a=function(t){function e(){t.apply(this,arguments),this.name="EditorImplementationError"}return n(e,t),e}(i.FormError),s=function(t){function e(){t.apply(this,arguments),this.name="EditorError"}return n(e,t),e}(i.FormError),u=function(t){function e(e){if(!e||!e.name)throw new s("no name specified");this.label=e.label,this._name=e.name,this._defaultValue=e.defaultValue,t.call(this,e)}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){throw new a("setValue not implemented")},e.prototype.getValue=function(){throw new a("getValue not implemented")},e.prototype.clear=function(){throw new a("clear not implemented")},e.prototype.validate=function(){return null},e.prototype.triggerChange=function(t){this.triggerMethod("change",this)},e.prototype.render=function(){return this.undelegateEvents(),t.prototype.render.call(this),this.delegateEvents(),this},e.prototype.setDefault=function(){null!=this._defaultValue&&this.setValue(this._defaultValue)},e}(o.TemplateView);e.Editor=u;var l=function(t){function e(e){if(!e||!e.name)throw new s("no name specified");this._name=e.name,this._defaultValue=e.defaultValue,t.call(this,e)}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){throw new a("setValue not implemented")},e.prototype.getValue=function(){throw new a("getValue not implemented")},e.prototype.clear=function(){throw new a("clear not implemented")},e.prototype.validate=function(){return null},e.prototype.triggerChange=function(t){this.triggerMethod("change",this)},e.prototype.setDefault=function(){null!=this._defaultValue&&this.setValue(this._defaultValue)},e}(o.CollectionView);e.CollectionEditor=l},function(e,r){e.exports=t},function(t,e){var r=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},n=function(){function t(t,e){this.name="FormError",this.message=t}return t.prototype.toString=function(){return this.name+": "+this.message},t.prototype.toJSON=function(){return{name:this.name,message:this.message,code:this.code}},t}();e.FormError=n;var o=function(t){function e(e,r,n){t.call(this,n),this.name="FormValidationError",this.name=e,this.value=r}return r(e,t),e}(n);e.FormValidationError=o;var i=function(t){function e(e,r){t.call(this,null),this.name=e,this.errors=r}return r(e,t),e.prototype.toJSON=function(){return{name:this.name,errors:this.errors.map(function(t){return t.message})}},e}(n);e.FormEditorValidationError=i},function(t,e,r){function n(t,e){return e?e.replace(/\{{name\}}/,t.label||t.name):null}function o(t,e,r,n){return void 0===n&&(n=!1),new Promise(function(r,o){function i(c,h){return c&&!n?o(c):(c&&l.push(c),a===u?l.length?o(s.utils.flatten(l)):r():void e(t[a++]).then(function(t){i(null,t)},i))}var a=0,u=t.length,l=[];i(null)})}function i(t){var e=[],r=t.length,n=Array(r),o=0,i=r-0;return 0===r?Promise.resolve():new Promise(function(a,u){function l(t,r){t.then(function(t){return n[r]=t,0===--i?e.length?u(s.utils.flatten(e)):a(n.length?n:null):void 0},function(t){e.push(t),0===--i&&u(s.utils.flatten(e))})}for(o;r>o;o++)l(t[o],o)})}var a=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},s=r(2),u=r(5),l=r(3),c=r(11),h=function(t){function e(r){null!=r&&(r=s.utils.extend({},e.defaults,r)),t.call(this,r),this.strict=r.strict||this.strict||!1,this.autoValidate=r.autoValidate||this.autoValidate||!1,this._validator=r.validator||new c.Validator,this._validations={}}return a(e,t),Object.defineProperty(e,"defaults",{get:function(){return{selector:"[name]",attribute:"form-editor"}},enumerable:!0,configurable:!0}),e.prototype.render=function(e){return this._destroyEditors(),t.prototype.render.call(this,e),this._renderEditors(),this},Object.defineProperty(e.prototype,"val",{get:function(){return this.getValue()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"editors",{get:function(){return s.utils.extend({},this._editors)},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){this.trigger("before:setvalue",t);for(var e in t)if(this.editors[e]){this.trigger("before:setvalue:"+e);try{this.editors[e].setValue(t[e])}catch(r){}this.trigger("setvalue:"+e)}else{var n="form does not have an editor for: '"+e+"'";if(this.strict)throw new l.FormError(n);console.warn(n)}return this.trigger("setvalue"),this},e.prototype.getValue=function(){var t={};for(var e in this.editors){var r=this.editors[e];t[e]=r.getValue()}return t},e.prototype.clear=function(){this.triggerMethod("before:clear");for(var t in this.editors)this.editors[t].clear();this.triggerMethod("clear")},e.prototype.validateEditor=function(t){var e=this,r=this.editors[t];if(!r)return Promise.reject(new l.FormError("no editor named "+t));var o=c.errorToPromise(r.validate()),a=[];if(o&&a.push(o),this._validations[r.name]){var s=r.getValue(),u=this._validations[r.name].map(function(t){return c.errorToPromise(e._validator.validate(r.el,s,t))});a=a.concat(u)}return i(a)["catch"](function(t){t.forEach(function(t){var e=t.message||c.Validator.messages[t.name];t.message=n(r,e)});var e=new l.FormEditorValidationError(r.name,t);throw r.trigger("invalid",e),e})},e.prototype.validate=function(){var t=this,e=Object.keys(this.editors);return o(e,function(e){return t.validateEditor.call(t,e)},this,!0).then(function(t){return null})["catch"](function(t){var e={};return t.forEach(function(t){console.log(t),e[t.name]=t}),e})},e.prototype._getElements=function(t,e){var r,n,o,i,a=t.querySelectorAll(e.selector),c={};for(r=0;r<a.length;r++){n=a[r],o=n.getAttribute(e.attribute);var h=n.getAttribute("name");o=o||this._getType(n);var f=u.get(o);if(null!=f){i=n.getAttribute("required");var d=s.utils.result(e,h,void 0,[this,e])||{};d=s.utils.extend(d,e.editors[h]||{}),d.name=h,d.el=n,null!=i&&(d.validations||(d.validations=[])).push({name:"required"});var p=new f(d);d.validations&&this._validator&&(this._validator.bootstrap&&this._validator.bootstrap(n),this._validations[h]=d.validations),this.listenTo(p,"change",this._onEditorChange),this.listenTo(p,"invalid",this._onEditorInvalid),c[h]=p}else{var m="editor not found: '"+o+"' for '"+h+"'";if(this.strict)throw new l.FormError(m);console.warn(m)}}return c},e.prototype._renderEditors=function(){this._editors=this._getElements(this.el,this._options||{});for(var t in this._editors)this._editors[t].render()},e.prototype._destroyEditors=function(){for(var t in this.editors)this.stopListening(this.editors[t]),this.editors[t].destroy();this._editors={}},e.prototype._onEditorChange=function(t){this.triggerMethod("change",t)},e.prototype._onEditorInvalid=function(t){var e=this.editors[t.name];this.triggerMethod("invalid",e,t)},e.prototype._getType=function(t){return"INPUT"===t.nodeName?t.type.toLowerCase():t.nodeName.toLowerCase()},e.prototype.destroy=function(){this._destroyEditors(),t.prototype.destroy.call(this)},e}(s.TemplateView);e.Form=h},function(t,e,r){function n(t){return null!=o(t)}function o(t){return c[t]}function i(t,e){c[e]=t}var a=r(6),s=r(7),u=r(9),l=r(10),c={input:a.InputEditor,text:a.InputEditor,checkbox:a.InputEditor,radio:a.InputEditor,textarea:a.InputEditor,list:s.ListEditor,number:u.NumberEditor,select:l.SelectEditor};e.has=n,e.get=o,e.set=i},function(t,e,r){var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},o=this&&this.__decorate||function(t,e,r,n){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,r,n);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,n){return void(n&&n(e,r))},void 0);case 4:return t.reduceRight(function(t,n){return n&&n(e,r,t)||t},n)}},i=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},a=r(1),s=r(2),u=function(t){function e(){t.apply(this,arguments)}return n(e,t),e.prototype.setValue=function(t){"INPUT"===this.el.nodeName&&~["checkbox","radio"].indexOf(this.el.type)?this.el.checked=!!t:"INPUT"===this.el.nodeName&&"file"===this.el.type||(this.el.value=null==t?"":t)},e.prototype.getValue=function(){return"INPUT"===this.el.nodeName&&~["checkbox","radio"].indexOf(this.el.type)?this.el.checked:"INPUT"===this.el.nodeName&&"file"===this.el.type?this.el.files:""===this.el.value?null:this.el.value},e.prototype.clear=function(){this.el.value="",this.setDefault()},e.prototype._onChange=function(){var t=this.getValue();s.utils.equal(t,this._prev)||this.triggerChange()},e=o([s.events({change:"_onChange"}),i("design:paramtypes",[])],e)}(a.Editor);e.InputEditor=u},function(t,e,r){var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},o=r(2),i=r(8),a=o.CollectionView.extend({tagName:"select",events:{change:function(t){var e=this.el.options[this.el.selectedIndex],r=e.getAttribute("cid"),n=o.utils.find(this.children,function(t){return t.cid===r});if(null==n)throw new i.FormError("could not find view for option "+r);this.trigger("select",n.model)}},childView:o.DataView.extend({tagName:"option",template:function(t){return this.el.setAttribute("value",t.value),this.el.setAttribute("cid",this.cid),t.name}},{})},{}),s=function(t){function e(){t.apply(this,arguments),this.idAttribute="value"}return n(e,t),e}(o.Model);e.ListEditorModel=s;var u=function(t){function e(e){var r=this;if(e.items&&(e.collection=new o.Collection(e.items,{model:s})),this._name=e.name,this._values=new o.Collection(e.values||[]),this._selectView=new a({collection:e.collection||new o.Collection([])}),this._listView=new o.CollectionView({tagName:"ul",collection:this._values,childViewOptions:{triggers:{click:"click"},tagName:"li",template:function(t){return t.name}}}),this.listenTo(this._listView,"childview:click",function(t){var e=t.model;this._values.remove(e)}),this.listenTo(this._selectView,"select",function(t){r._values.add(t.clone())}),null==this.name)throw new i.FormError("name property is required");t.call(this,e)}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"val",{get:function(){return this.getValue()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}),e.prototype.setValue=function(t){this._values.reset(t)},e.prototype.getValue=function(){return this._values.toJSON()},e.prototype.clear=function(){this._values.reset([])},e.prototype.validate=function(){return null},e.prototype.render=function(){return this.el.appendChild(this._selectView.render().el),this.el.appendChild(this._listView.render().el),this},e.prototype.destroy=function(){this._selectView.destroy(),this._listView.destroy(),t.prototype.destroy.call(this)},e}(o.View);e.ListEditor=u},function(t,e){var r=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},n=function(){function t(t,e){this.name="FormError",this.message=t}return t.prototype.toString=function(){return this.name+": "+this.message},t.prototype.toJSON=function(){return{name:this.name,message:this.message,code:this.code}},t}();e.FormError=n;var o=function(t){function e(e,r,n){t.call(this,n),this.name="FormValidationError",this.name=e,this.value=r}return r(e,t),e}(n);e.FormValidationError=o;var i=function(t){function e(e,r){t.call(this,null),this.name=e,this.errors=r}return r(e,t),e.prototype.toJSON=function(){return{name:this.name,errors:this.errors.map(function(t){return t.message})}},e}(n);e.FormEditorValidationError=i},function(t,e,r){var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},o=this&&this.__decorate||function(t,e,r,n){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,r,n);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,n){return void(n&&n(e,r))},void 0);case 4:return t.reduceRight(function(t,n){return n&&n(e,r,t)||t},n)}},i=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},a=r(2),s=r(1),u=function(t){function e(e){t.call(this,e),this._floating=null==e["float"]?!1:e["float"]}return n(e,t),e.prototype._onKeyPress=function(t){var e=String.fromCharCode(t.which),r=this.el.value;if(8==t.which&&(e=e.substr(0,e.length-2)),!~r.indexOf(",")&&","===e&&this._floating){var n=this.el.selectionStart;if(""!=r&&0!==n)return;this.el.value="0,"+this.el.value,this.el.setSelectionRange(2,2)}isNaN(parseFloat(e))&&t.preventDefault()},e.prototype.setValue=function(t){this.el.value=""+(this._floating?t:Math.round(t))},e.prototype.getValue=function(){var t=this.el.value;return""===t?null:this._floating?parseFloat(t.replace(",",".")):parseInt(t)},e.prototype.clear=function(){this.el.value="",this.setDefault()},e=o([a.events({keypress:"_onKeyPress"}),i("design:paramtypes",[Object])],e)}(s.Editor);e.NumberEditor=u},function(t,e,r){var n=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);r.prototype=e.prototype,t.prototype=new r},o=this&&this.__decorate||function(t,e,r,n){if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)return Reflect.decorate(t,e,r,n);switch(arguments.length){case 2:return t.reduceRight(function(t,e){return e&&e(t)||t},e);case 3:return t.reduceRight(function(t,n){return void(n&&n(e,r))},void 0);case 4:return t.reduceRight(function(t,n){return n&&n(e,r,t)||t},n)}},i=this&&this.__metadata||function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},a=r(2),s=r(1),u=function(t){function e(e){t.call(this,e)}return n(e,t),e.prototype.setValue=function(t){for(var e=null,r=0;r<this.el.options.length;r++){var n=this.el.options[r];if(n.value===t.value&&n.innerText===t.text){e=r;break}}null!==e&&(this.el.selectedIndex=e)},e.prototype.getValue=function(){var t=this.el.options[this.el.selectedIndex];return{value:t.value,text:t.innerText}},e.prototype.clear=function(){this.setDefault()},e=o([a.events({change:"triggerChange"}),i("design:paramtypes",[Object])],e)}(s.Editor);e.SelectEditor=u},function(t,e,r){function n(t){return t instanceof Error||t instanceof o.FormValidationError?Promise.reject(t):i.utils.isPromise(t)?t:Promise.resolve(null)}var o=r(8),i=r(2);e.errorToPromise=n;var a=function(){function t(){}return t.prototype.validate=function(e,r,i){if("required"===i.name)return null==r?Promise.reject(new o.FormValidationError("required",r)):null;if(t.validators[i.name]){var a=t.validators[i.name](e,r);return n(a)}return null},t.validators={},t.messages={},t}();e.Validator=a}])});